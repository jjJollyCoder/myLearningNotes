
# ğŸŒ Flask å®æˆ˜é¡¹ç›®å¼€å‘çŸ¥è¯†æ€»ç»“

> ç”¨äºæ„å»ºä¸€ä¸ªâ€œç‚¹å‡»æŒ‰é’®å³å¯æ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬â€çš„ä¸ªäººæœ¬åœ° Web æœåŠ¡ï¼Œå¹¶å¯æ‰©å±•ä¸ºæ›´å¼ºå¤§çš„ä»»åŠ¡ä¸­å¿ƒã€‚

---

## ğŸ” ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© Flaskï¼Ÿ

### âœ… Flask æ˜¯ä»€ä¹ˆï¼Ÿ

Flask æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Python Web æ¡†æ¶ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å°å‹æˆ–ä¸­å‹é¡¹ç›®ã€‚

### âœ… ä¸ºä»€ä¹ˆè¦ç”¨ Flaskï¼Œè€Œä¸æ˜¯ä»…é  HTMLï¼Ÿ

* å•çº¯æ‰“å¼€ HTML é¡µé¢æ˜¯**é™æ€çš„**ï¼Œæ— æ³•æ‰§è¡Œ Python è„šæœ¬ã€‚
* Flask å¯ä»¥ä½œä¸º **ä¸­é—´å±‚ï¼ˆåç«¯æœåŠ¡å™¨ï¼‰**ï¼Œå“åº”æµè§ˆå™¨è¯·æ±‚ï¼Œå¹¶**æ‰§è¡Œ Python è„šæœ¬é€»è¾‘**ã€‚
* æ‰“å¼€ `localhost:8000` å°±æ˜¯åœ¨è®¿é—® Flask æä¾›çš„ HTTP æœåŠ¡ã€‚

### âœ… ä½ çš„é¡¹ç›®é€‚åˆ Flask çš„åŸå› 

* ä½ çš„éœ€æ±‚æ˜¯ï¼š

  * æœ¬åœ°é¡µé¢ä¸Šç‚¹å‡»æŒ‰é’®ï¼›
  * åç«¯æ‰§è¡Œä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆå¦‚æ‹¼æ¥ ID å¹¶æ‰“å¼€é“¾æ¥ï¼‰ï¼›
* è¿™ç±»è½»é€»è¾‘çš„**å•ç”¨æˆ·ã€æœ¬åœ°ä»»åŠ¡æ‰§è¡Œå™¨** â†’ éå¸¸é€‚åˆç”¨ Flask å®ç°ï¼›
* è‹¥é‡‡ç”¨æ›´é‡å‹æ¡†æ¶ï¼ˆå¦‚ Djangoï¼‰åˆ™ä¼šæ˜æ˜¾**å¼€å‘æˆæœ¬è¿‡é«˜ã€é…ç½®ç¹ç**ï¼›
* Flask æ”¯æŒæ‰©å±•å’Œå‰åç«¯èåˆï¼Œ**èµ·æ­¥å¿«ã€æ‰©å±•æ€§å¼º**ã€‚

---

## âš–ï¸ äºŒã€Flask çš„ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹               | ç¼ºç‚¹                   |
| ---------------- | -------------------- |
| ç®€å•æ˜“å­¦ï¼Œé€‚åˆåˆå­¦è€…å’Œå¿«é€ŸåŸå‹  | ç¼ºå°‘é»˜è®¤åŠŸèƒ½ï¼ˆå¦‚æ•°æ®åº“ã€è®¤è¯éœ€æ‰‹åŠ¨é…ç½®ï¼‰ |
| çµæ´»ï¼Œè‡ªç”±åº¦é«˜          | è‡ªç”±åº¦é«˜å¯¼è‡´å¤§å‹é¡¹ç›®æ˜“å¤±æ§        |
| æ–‡æ¡£ä¸°å¯Œã€ç¤¾åŒºæ´»è·ƒ        | ä¸æ˜¯æœ€ä½³é€‰æ‹©ç”¨äºé«˜å¹¶å‘å¤§å‹ç³»ç»Ÿ      |
| å’Œå‰ç«¯é›†æˆç®€å•ï¼ˆHTMLã€JSï¼‰ | éœ€è¦æ‰‹åŠ¨å¤„ç†å®‰å…¨æ€§ã€ç»“æ„åˆ’åˆ†ç­‰      |

---

## ğŸ” ä¸‰ã€æ˜¯å¦æœ‰æ›¿ä»£æ¡†æ¶ï¼Ÿ

| æ¡†æ¶                 | ç‰¹ç‚¹             | æ˜¯å¦é€‚åˆä½ å½“å‰é¡¹ç›®          |
| ------------------ | -------------- | ------------------ |
| **Flask**          | ç®€æ´çµæ´»ã€åŠŸèƒ½å¤Ÿç”¨      | âœ… æœ€é€‚åˆä½ çš„åœºæ™¯          |
| Django             | å…¨å®¶æ¡¶ï¼ŒåŠŸèƒ½å…¨é¢       | âŒ å¤ªé‡ï¼Œé…ç½®å¤æ‚          |
| FastAPI            | ç°ä»£åŒ–ï¼ŒAPI ä¼˜å…ˆï¼Œæ€§èƒ½é«˜ | âŒ å API è®¾è®¡ï¼Œä¸é€‚åˆæ¨¡æ¿æ¸²æŸ“ |
| Streamlit / Gradio | ä¸ºæ•°æ®ç§‘å­¦å’Œäº¤äº’ç•Œé¢è®¾è®¡   | âš ï¸ å¯è€ƒè™‘ï¼Œä½†å¯¹æ ·å¼æ§åˆ¶åŠ›å¼±    |
| Tkinter / PyQT     | æ¡Œé¢ GUI         | âŒ ä¸é€‚ç”¨äºæµè§ˆå™¨äº¤äº’éœ€æ±‚      |

---

## ğŸ—‚ å››ã€é¡¹ç›®æ¨èç›®å½•ç»“æ„

```bash
my_web_automation/
â”œâ”€â”€ venv/                   # è™šæ‹Ÿç¯å¢ƒï¼ˆä¸ä¸Šä¼ ï¼‰
â”œâ”€â”€ run_server.py           # ä¸» Flask æœåŠ¡å…¥å£
â”œâ”€â”€ auto_script.py          # ä½ è‡ªå·±çš„ Python è‡ªåŠ¨åŒ–ä»»åŠ¡é€»è¾‘
â”œâ”€â”€ requirements.txt        # æ‰€æœ‰ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ static/                 # æ”¾ç½® CSSã€JSã€å›¾ç‰‡ç­‰å‰ç«¯èµ„æº
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ templates/              # HTML æ¨¡æ¿ç›®å½•
â”‚   â””â”€â”€ index.html
â””â”€â”€ .gitignore              # å¿½ç•¥ venvã€pyc ç­‰
```

---

## ğŸš€ äº”ã€æœ¬åœ°è¿è¡Œ Flask æœåŠ¡æ­¥éª¤

### âœ… è™šæ‹Ÿç¯å¢ƒå‡†å¤‡

```bash
python3 -m venv venv
source venv/bin/activate
pip install flask
pip freeze > requirements.txt
```

### âœ… Flask å¯åŠ¨å‘½ä»¤

```bash
python run_server.py
```

è¾“å‡ºå†…å®¹ç±»ä¼¼ï¼š

```
* Running on http://localhost:8000/
```

æµè§ˆå™¨è®¿é—®å³å¯æ‰“å¼€é¡µé¢ã€‚

---

## ğŸ’¡ å…­ã€å…¸å‹ä»£ç ç¤ºä¾‹

### 1. `run_server.py`

```python
from flask import Flask, render_template, redirect
import auto_script

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/run')
def run():
    auto_script.run_my_script()
    return redirect('/')

if __name__ == '__main__':
    app.run(port=8000)
```

### 2. `auto_script.py`

```python
import webbrowser

def run_my_script():
    with open('ids.txt', 'r') as f:
        ids = [line.strip() for line in f if line.strip()]
    url = f"rdar://problem/{'&'.join(ids)}"
    webbrowser.open(url)
```

### 3. `templates/index.html`

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æˆ‘çš„è‡ªåŠ¨åŒ–é¡µé¢</title>
</head>
<body>
  <h1>æ¬¢è¿æ¥åˆ°æˆ‘çš„è‡ªåŠ¨åŒ–åŠ©æ‰‹</h1>
  <form action="/run">
    <button type="submit">ğŸ“Œ ç‚¹å‡»æ‰§è¡Œè„šæœ¬</button>
  </form>
</body>
</html>
```

---

## ğŸ§¯ ä¸ƒã€å¸¸è§æŠ¥é”™ä¸è§£å†³åŠæ³•

| æŠ¥é”™ä¿¡æ¯                                           | åŸå›                   | è§£å†³åŠæ³•                                    |
| ---------------------------------------------- | ------------------- | --------------------------------------- |
| `ModuleNotFoundError: No module named 'flask'` | å½“å‰ç¯å¢ƒæ²¡å®‰è£… Flask       | å…ˆæ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œå† `pip install flask`           |
| `SyntaxError: Non-ASCII character ...`         | ä¸­æ–‡å­—ç¬¦æœªå£°æ˜ç¼–ç            | åœ¨ `.py` æ–‡ä»¶é¦–è¡ŒåŠ  `# -*- coding: utf-8 -*-` |
| `Permission denied`                            | ç³»ç»Ÿè·¯å¾„è¢«å†™ä¿æŠ¤            | ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæˆ– `--user` å®‰è£…                     |
| `can't open file ... No such file`             | è¿è¡Œè·¯å¾„ä¸æ­£ç¡®             | ç¡®ä¿å½“å‰ç›®å½•å«æœ‰è¯¥æ–‡ä»¶                             |
| é¡µé¢æ ·å¼é”™ä¹±                                         | æ²¡æœ‰ä½¿ç”¨ static æ ·å¼æˆ–è·¯å¾„ä¸å¯¹ | æ­£ç¡®å¼•ç”¨ `static/style.css`                 |
| é¡µé¢è¿”å› 404                                       | Flask è·¯ç”±ä¸åŒ¹é…         | æ£€æŸ¥ `@app.route()` å’Œé“¾æ¥æ˜¯å¦ä¸€è‡´               |

---

## ğŸ§± å…«ã€å¯æ‰©å±•åŠŸèƒ½å»ºè®®

| åŠŸèƒ½         | ç®€è¿°                            |
| ---------- | ----------------------------- |
| âœ… æ·»åŠ å¤šä¸ªæŒ‰é’®   | æ¯ä¸ªæŒ‰é’®è°ƒç”¨ä¸åŒè„šæœ¬                    |
| âœ… ä¸Šä¼ æ–‡ä»¶     | æ”¯æŒä¸Šä¼  ID æ–‡ä»¶                    |
| âœ… è‡ªåŠ¨åŠ è½½å½“å¤©ä»»åŠ¡ | æ ¹æ®æ—¥æœŸè¯»å–ä¸åŒçš„ txt                 |
| âœ… æ·»åŠ æ‰§è¡Œå†å²   | å°†è¿è¡Œæ—¥å¿—è®°å½•                       |
| âœ… ç¾åŒ–ç•Œé¢     | ä½¿ç”¨ Bootstrap/FontAwesome      |
| âœ… å®šæ—¶ä»»åŠ¡     | ç»“åˆ `cron` æˆ– Flask APScheduler |
| âœ… æ¥å…¥æ•°æ®åº“    | ç”¨äºä»»åŠ¡è®°å½•æˆ–é…ç½®                     |

---

## ğŸ“„ ä¹ã€requirements.txt ç¤ºä¾‹

```txt
Flask==2.3.3
```
---

## ğŸ”— åã€Flask API æ‹“å±•èƒ½åŠ›è¯¦è§£

> å¦‚æœä½ çš„æŒ‰é’®ä¸æ­¢åœ¨ç½‘é¡µé‡Œç”¨ï¼Œè€Œè¿˜æƒ³é€šè¿‡å…¶ä»–ç¨‹åºè°ƒç”¨ï¼Œæˆ–è€…å‰åç«¯è§£è€¦ï¼Œå°±éœ€è¦ç”¨ APIï¼

---

### â“ ä¸ºä»€ä¹ˆè¦ç”¨ APIï¼Ÿ

* \*\*APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰\*\*è®©å‰ç«¯ã€è„šæœ¬ã€å¤–éƒ¨ç¨‹åºéƒ½èƒ½é€šè¿‡ç½‘ç»œè¯·æ±‚è§¦å‘åç«¯é€»è¾‘ï¼›
* **é€‚ç”¨åœºæ™¯ï¼š**

  * æƒ³ä»å‘½ä»¤è¡Œã€ç¬¬ä¸‰æ–¹ç³»ç»Ÿã€ç§»åŠ¨ App é‡Œè¿œç¨‹è°ƒç”¨ä½ å†™çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼›
  * æƒ³è®©é¡µé¢ç‚¹å‡»æŒ‰é’®ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼ˆç”¨ AJAX è°ƒç”¨åç«¯ APIï¼‰ï¼›
  * æƒ³ä¸ºå¤šäººå…±äº«ï¼ˆæˆ–è‡ªå·±è¿œç¨‹è®¿é—®ï¼‰æŸäº›è„šæœ¬æ‰§è¡ŒæœåŠ¡ï¼›
  * æƒ³å°†å¤šä¸ªå‰ç«¯é¡µé¢å…±äº«åŒä¸€åç«¯é€»è¾‘ã€‚

---

### âœ… ç”¨ Flask å®ç° API æœ‰å¤šç®€å•ï¼Ÿ

åªéœ€å°†åŸæœ‰è·¯ç”±æ¢æˆ `@app.route('/xxx', methods=['POST'])` å¹¶è¿”å› JSONï¼š

```python
from flask import Flask, jsonify, request
import auto_script

app = Flask(__name__)

@app.route('/api/run', methods=['POST'])
def run_script_api():
    result = auto_script.run_my_script()
    return jsonify({"status": "success", "msg": result})
```

ä½ å¯ä»¥ä½¿ç”¨ `curl`ã€Pythonã€JSã€Postman ç­‰æ–¹å¼è°ƒç”¨è¿™ä¸ªæ¥å£ï¼š

```bash
curl -X POST http://localhost:8000/api/run
```

---

### âš–ï¸ ä½¿ç”¨ API çš„ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹                | ç¼ºç‚¹                   |
| ----------------- | -------------------- |
| å‰åç«¯è§£è€¦ï¼Œçµæ´»æ€§å¼º        | éœ€è¦æ›´å¤šå‰ç«¯å¤„ç†ï¼ˆå¦‚ç”¨ JS å‘è¯·æ±‚ï¼‰  |
| æ˜“äºè‡ªåŠ¨åŒ–è°ƒç”¨ï¼Œå¯é›†æˆå…¶ä»–ç³»ç»Ÿ   | é”™è¯¯å¤„ç†ã€æƒé™éœ€é¢å¤–ç¼–ç          |
| å¯ä»¥è¢«æ‰‹æœºã€å‘½ä»¤è¡Œç­‰å¤šå¹³å°ä½¿ç”¨   | ä¸å¦‚é¡µé¢ç›´è§‚ï¼ˆå°¤å…¶å¯¹éæŠ€æœ¯ç”¨æˆ·ï¼‰     |
| è¿”å› JSONï¼Œæ˜“è¢«å‰ç«¯æˆ–è„šæœ¬è§£æ | éœ€è¦æ›´ç³»ç»Ÿæ€§è®¾è®¡ï¼ˆRESTful æœ€ä½³ï¼‰ |

---

### ğŸ“¦ æˆ‘çš„é¡¹ç›®é€‚åˆåŠ  API å—ï¼Ÿ

æ˜¯çš„ï¼Œå°¤å…¶é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

* ä½ å¸Œæœ›åç»­è®©å…¶ä»–äººå…±äº«è‡ªåŠ¨åŒ–è„šæœ¬è¿è¡Œæ¥å£ï¼›
* ä½ å¸Œæœ›å†™ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥è°ƒç”¨åå°é€»è¾‘ï¼›
* ä½ å¸Œæœ›è®©å‰ç«¯æŒ‰é’®ç‚¹äº†ä¸åˆ·æ–°æ•´é¡µï¼Œåªå¼¹æç¤ºï¼ˆAJAXï¼‰ï¼›
* ä½ è®¡åˆ’åç»­æ‰©å±•ä¸ºä¸€ä¸ª Web API æœåŠ¡å¹³å°ï¼ˆå¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼‰ã€‚

---

### ğŸ”§ API å¯æ‰©å±•çš„åŠŸèƒ½æ–¹å‘

| åŠŸèƒ½                | å®ç°æ€è·¯                             |
| ----------------- | -------------------------------- |
| âœ… è¿”å›æ‰§è¡Œç»“æœ          | `return jsonify({...})` æ›¿ä»£é‡å®šå‘    |
| âœ… æ‰§è¡Œå¤šä¸ªä»»åŠ¡          | æä¾› `task_type` å‚æ•°ï¼Œåç«¯åˆ†æµ           |
| âœ… åŠ æƒé™éªŒè¯           | ç”¨ `@app.before_request` æ£€æŸ¥ Token |
| âœ… é™åˆ¶è°ƒç”¨é¢‘ç‡          | ç»“åˆ Flask-Limiter                 |
| âœ… è°ƒç”¨çŠ¶æ€è½®è¯¢          | å‰ç«¯å‘¨æœŸæ€§è°ƒç”¨ `/api/status`            |
| âœ… è¿”å›è¿›åº¦æ¡           | æ­é…ä»»åŠ¡é˜Ÿåˆ—æˆ– WebSocket é€šä¿¡             |
| âœ… å…è®¸è¿œç¨‹ POST ID æ•°æ® | æ¥æ”¶ JSON æ ¼å¼å¹¶ä¼ ç»™è„šæœ¬å¤„ç†                |
| âœ… æ·»åŠ é”™è¯¯æ—¥å¿—æ¥å£        | `POST /api/report_error` ä¸Šä¼ å¼‚å¸¸ä¿¡æ¯  |
| âœ… æ¥å…¥èŠå¤©æœºå™¨äººæˆ–é‚®ä»¶é€šçŸ¥    | è„šæœ¬ä¸­åŠ å…¥å‘é€é€šçŸ¥çš„é€»è¾‘                     |

---

### ğŸ§ª ç¤ºä¾‹ï¼šå‰ç«¯ AJAX è°ƒç”¨ API

```html
<script>
  function runScript() {
    fetch('/api/run', { method: 'POST' })
      .then(response => response.json())
      .then(data => alert(data.msg || 'æ‰§è¡ŒæˆåŠŸï¼'))
      .catch(err => alert('æ‰§è¡Œå¤±è´¥'));
  }
</script>

<button onclick="runScript()">ç‚¹å‡»è¿è¡Œ</button>
```

---

### ğŸ§± è¡¥å…… API æ‰€éœ€ä¾èµ–ï¼ˆå·²å†…ç½®ï¼‰

Flask è‡ªå¸¦ `jsonify` å’Œ `request` æ¨¡å—ï¼Œä¸éœ€é¢å¤–å®‰è£…ã€‚

å¦‚éœ€æ‰©å±•å¯åŠ ï¼š

```bash
pip install flask-limiter flask-cors flask-login
```

---

## ğŸ” åä¸€ã€API çš„åè®®ã€å®‰å…¨è®¤è¯ä¸è°ƒè¯•æŒ‡å—

---

### ğŸŒ 1. HTTP ä¸ HTTPSï¼šé€‰æ‹©å“ªä¸€ä¸ªï¼Ÿ

| é¡¹ç›®        | HTTP        | HTTPS      |
| --------- | ----------- | ---------- |
| åŠ å¯†æ€§       | âŒ æ˜æ–‡ä¼ è¾“ï¼Œæ˜“è¢«ç›‘å¬ | âœ… æ•°æ®åŠ å¯†ï¼Œå®‰å…¨  |
| å®‰å…¨æ€§       | âŒ æ˜“è¢«ä¸­é—´äººæ”»å‡»   | âœ… é˜²ç¯¡æ”¹ã€é˜²ç›‘å¬  |
| åœºæ™¯        | æœ¬åœ°å¼€å‘ã€æµ‹è¯•     | ä¸Šçº¿éƒ¨ç½²ï¼ˆå¼ºçƒˆæ¨èï¼‰ |
| æ˜¯å¦å¯è·³è¿‡è¯ä¹¦éªŒè¯ | âœ…           | å¯é€‰è·³è¿‡ï¼Œé£é™©è¾ƒé«˜  |

#### ğŸ’¡ æœ¬åœ° Flask å¼€å‘é»˜è®¤å°±æ˜¯ `http://localhost:8000`ï¼Œä¸Šçº¿æ—¶å»ºè®®ç”¨ nginx + gunicorn + Let's Encrypt å…è´¹è¯ä¹¦ æä¾› HTTPSã€‚

---

### ğŸ”‘ 2. API é‰´æƒæ–¹å¼å¯¹æ¯”ï¼ˆä½ å¯èƒ½ä¼šç”¨çš„ï¼‰

| è®¤è¯æ–¹å¼         | ç‰¹ç‚¹                     | é€‚ç”¨åœºæ™¯         |
| ------------ | ---------------------- | ------------ |
| æ— è®¤è¯ï¼ˆé»˜è®¤ï¼‰      | ç®€å•æ˜“ç”¨ï¼Œæ— éœ€å¤„ç†              | ä¸ªäººä½¿ç”¨ã€æœ¬åœ°å¼€å‘    |
| Token é‰´æƒ     | å‰ç«¯è¯·æ±‚æºå¸¦ Tokenï¼Œåç«¯éªŒè¯      | å†…ç½‘åº”ç”¨ã€ç®€æ˜“æƒé™    |
| Basic Auth   | HTTP æ ‡å‡†ï¼ŒBase64 ç¼–ç ç”¨æˆ·åå¯†ç  | ç®€å•æ¥å£ä¿æŠ¤       |
| Session ç™»å½•æ€  | ç™»å½•åæœåŠ¡ç«¯è®°ä½ç”¨æˆ·             | é¡µé¢ç™»å½•ç³»ç»Ÿå¸¸è§     |
| OAuth2 / JWT | å®‰å…¨æ ‡å‡†ï¼Œè·¨åŸŸã€è·¨å¹³å°æ”¯æŒ          | å¤šäººå…±äº«å¹³å°æˆ–å¯¹æ¥ç¬¬ä¸‰æ–¹ |

---

### ğŸ› ï¸ 3. å®ç° Token é‰´æƒï¼ˆæœ€æ¨èçš„ç®€å•æ–¹æ¡ˆï¼‰

#### 1ï¼‰å®šä¹‰ Token å’ŒéªŒè¯é€»è¾‘ï¼š

```python
from flask import Flask, request, jsonify, abort

app = Flask(__name__)
API_TOKEN = "your_secret_token_here"

@app.before_request
def check_token():
    if request.path.startswith('/api'):
        token = request.headers.get("Authorization")
        if token != f"Bearer {API_TOKEN}":
            return jsonify({"error": "Unauthorized"}), 401
```

#### 2ï¼‰è°ƒç”¨æ—¶æ·»åŠ  Headerï¼š

```bash
curl -X POST http://localhost:8000/api/run \
  -H "Authorization: Bearer your_secret_token_here"
```

#### 3ï¼‰JS å‰ç«¯ç¤ºä¾‹ï¼š

```js
fetch('/api/run', {
  method: 'POST',
  headers: { 'Authorization': 'Bearer your_secret_token_here' }
});
```

---

### ğŸ§ª 4. API è°ƒè¯•æŠ€å·§ï¼ˆå¼€å‘è€…å‹å¥½ï¼‰

| å·¥å…·                     | ç”¨é€”                            |
| ---------------------- | ----------------------------- |
| `curl`                 | å‘½ä»¤è¡Œå¿«é€Ÿæµ‹è¯•æ¥å£                     |
| `Postman` / `Insomnia` | å¯è§†åŒ–æµ‹è¯•ã€ä¿å­˜æ¥å£è¯·æ±‚å†å²                |
| æµè§ˆå™¨æ§åˆ¶å° + Fetch         | è°ƒè¯• JS è°ƒç”¨ API æ˜¯å¦æˆåŠŸ             |
| æ—¥å¿—æ‰“å°ï¼ˆFlaskï¼‰            | `print(request.headers)` è¾“å‡ºè°ƒè¯• |
| çŠ¶æ€ç æ£€æŸ¥                  | 200 æ­£å¸¸ã€401 æƒé™é”™è¯¯ã€500 æœåŠ¡å™¨æŠ¥é”™     |

#### Postman ç¤ºä¾‹ï¼š

* URL: `http://localhost:8000/api/run`
* Method: `POST`
* Headers: `Authorization: Bearer your_secret_token_here`
* Body: raw æˆ– JSONï¼ˆå¯é€‰ï¼‰

---

### ğŸ§± 5. å¯æ‰©å±•çš„å®‰å…¨æªæ–½ï¼ˆä¸Šçº¿åæ¨èï¼‰

| å®‰å…¨æªæ–½                | è¯´æ˜                       |
| ------------------- | ------------------------ |
| âœ… HTTPS + å¼º Token   | é˜²ç›‘å¬ + æ‹’ç»æœªæˆæƒè¯·æ±‚            |
| âœ… Flask-CORS        | è·¨åŸŸé…ç½®ï¼Œå‰ç«¯åˆ†ç¦»é¡¹ç›®éœ€è¦            |
| âœ… IP ç™½åå•            | ä»…æŒ‡å®š IP å¯è°ƒç”¨               |
| âœ… Rate Limitingï¼ˆé™æµï¼‰ | é˜²æ­¢æ¥å£è¢«åˆ·çˆ†ï¼ˆç”¨ flask-limiterï¼‰ |
| âœ… æ—¥å¿—è¿½è¸ª + å‘Šè­¦         | å¯¹éæ³•è°ƒç”¨è®°å½•æ—¥å¿—                |

---

### ğŸ“¦ æ¨èæ‰©å±•åº“

```bash
pip install flask-cors flask-limiter python-dotenv
```

#### ç¤ºä¾‹ï¼šé™åˆ¶é¢‘ç‡ï¼Œæ¯åˆ†é’Ÿåªå…è®¸è®¿é—® 5 æ¬¡

```python
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address

limiter = Limiter(get_remote_address, app=app)
limiter.limit("5 per minute")(run_script_api)
```

---

### âœ… æ€»ç»“ï¼šä½ é¡¹ç›®å¦‚ä½•æ‰©å±• APIï¼Ÿ

| ç›®æ ‡     | æ¨èæ–¹æ¡ˆ                      |
| ------ | ------------------------- |
| æœ¬åœ°æŒ‰é’®è°ƒç”¨ | æ— éœ€è®¤è¯                      |
| è¿œç¨‹è„šæœ¬è°ƒç”¨ | ç”¨ Token                   |
| ç§»åŠ¨ç«¯è®¿é—®  | ç”¨ HTTPS + Token           |
| ä¸Šçº¿å¹³å°   | OAuth2 æˆ– JWTï¼ˆå¦‚ Flask-JWTï¼‰ |
| å¤šåŠŸèƒ½æ¥å£  | ç”¨ `/api/xxx` å¤šä¸ªå­è·¯å¾„ç®¡ç†      |
| ç¬¬ä¸‰æ–¹é›†æˆ  | ç”¨ Swagger æ–‡æ¡£ç”Ÿæˆæ¥å£æè¿°        |

---


